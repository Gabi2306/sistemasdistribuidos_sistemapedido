<!-- TARJETA: ESTADO DE NODOS -->
<div class="card mb-3">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h5 class="card-title mb-0">
        <i class="fas fa-server me-2"></i> Estado de Nodos
      </h5>
      <button class="btn btn-info btn-sm" (click)="verificarNodos()" [disabled]="loading">
        <i class="fas fa-sync-alt" [class.fa-spin]="loading"></i>
        <span class="ms-1">Actualizar</span>
      </button>
    </div>

    <!-- LOADING -->
    <div *ngIf="loading" class="text-center py-4">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
    </div>

    <!-- LISTA DE NODOS -->
    <div *ngIf="!loading">
      <!-- NODO ACTUAL -->
      <div class="zone-item fade-in" [style.border-left]="'4px solid #28a745'">
        <div class="zone-info">
          <h6>
            <i class="fas fa-server me-2"></i>{{ nodoActual }}
            <span class="badge bg-primary ms-2">ACTUAL</span>
          </h6>
          <small class="text-success">Estado: ACTIVO</small>
        </div>
        <span class="badge bg-success">
          <i class="fas fa-check-circle"></i>
        </span>
      </div>

      <!-- NODOS RÉPLICA -->
      <div *ngFor="let replica of replicas" class="zone-item fade-in"
        [style.border-left]="'4px solid ' + getEstadoColor(replica.estado)">
        <div class="zone-info">
          <h6>
            <i class="fas fa-server me-2"></i>{{ replica.nodo || replica.url }}
          </h6>
          <small [class]="replica.estado === 'activo' ? 'text-success' : 'text-danger'">
            Estado: {{ replica.estado.toUpperCase() }}
          </small>
          <small *ngIf="replica.error" class="d-block text-muted small-text">
            Error: {{ replica.error }}
          </small>
        </div>
        <span class="badge" [class]="getEstadoBadgeClass(replica.estado)">
          <i class="fas" [class]="getEstadoIcon(replica.estado)"></i>
        </span>
      </div>

      <!-- RESUMEN -->
      <div class="alert alert-info mt-3 mb-0">
        <i class="fas fa-info-circle me-2"></i>
        <strong>Nodos activos:</strong> {{ contarNodosActivos() }} de {{ replicas.length + 1 }}
      </div>
    </div>
  </div>
</div>

<!-- TARJETA: REPLICACIÓN -->
<div class="card mb-3">
  <div class="card-body">
    <h5 class="card-title">
      <i class="fas fa-sync me-2"></i> Replicación de Datos
    </h5>
    <p class="text-muted mb-3">
      Sincroniza los datos entre todos los nodos del sistema para mantener la consistencia.
    </p>

    <button class="btn btn-info w-100" (click)="ejecutarReplicacion()" [disabled]="replicacionEnProceso">
      <i class="fas fa-sync-alt me-2" [class.fa-spin]="replicacionEnProceso"></i>
      {{ replicacionEnProceso ? 'Replicando...' : 'Ejecutar Replicación Manual' }}
    </button>

    <!-- RESULTADOS DE REPLICACIÓN -->
    <div *ngIf="resultadosReplicacion.length > 0" class="mt-3">
      <hr>
      <h6><i class="fas fa-list me-2"></i>Resultados:</h6>
      <div class="alert alert-sm mb-2" *ngFor="let resultado of resultadosReplicacion"
        [class.alert-success]="resultado.status === 'success'" [class.alert-danger]="resultado.status === 'error'">
        <small>
          <strong>{{ resultado.nodo }}:</strong>
          {{ resultado.status.toUpperCase() }}
        </small>
        <small class="d-block text-muted" *ngIf="resultado.error">
          {{ resultado.error }}
        </small>
      </div>

      <div class="alert alert-info mb-0">
        <i class="fas fa-check-circle me-2"></i>
        <strong>Logs replicados:</strong> {{ logsReplicados }}
      </div>
    </div>
  </div>
</div>

<!-- TARJETA: INFORMACIÓN DEL SISTEMA -->
<div class="card" *ngIf="infoSistema">
  <div class="card-body">
    <h5 class="card-title">
      <i class="fas fa-info-circle me-2"></i> Información del Sistema
    </h5>

    <div class="info-row">
      <span class="info-label">
        <i class="fas fa-server me-2"></i>Nodo Actual:
      </span>
      <span class="info-value">{{ infoSistema.nodo_actual || nodoActual }}</span>
    </div>

    <div class="info-row">
      <span class="info-label">
        <i class="fas fa-network-wired me-2"></i>Puerto:
      </span>
      <span class="info-value">{{ infoSistema.puerto || '5000' }}</span>
    </div>

    <div class="info-row">
      <span class="info-label">
        <i class="fas fa-sync-alt me-2"></i>Replicación:
      </span>
      <span class="info-value">
        <span class="badge" [class.bg-success]="infoSistema.replicacion_habilitada"
          [class.bg-secondary]="!infoSistema.replicacion_habilitada">
          {{ infoSistema.replicacion_habilitada ? 'Habilitada' : 'Deshabilitada' }}
        </span>
      </span>
    </div>

    <div class="info-row" *ngIf="infoSistema.estadisticas">
      <span class="info-label">
        <i class="fas fa-shopping-cart me-2"></i>Total Pedidos:
      </span>
      <span class="info-value">{{ infoSistema.estadisticas.total_pedidos || 0 }}</span>
    </div>

    <div class="info-row" *ngIf="infoSistema.estadisticas">
      <span class="info-label">
        <i class="fas fa-dollar-sign me-2"></i>Total Facturado:
      </span>
      <span class="info-value">${{ (infoSistema.estadisticas.total_facturado || 0).toLocaleString('es-CO') }}</span>
    </div>
  </div>
</div>